<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ ¡å›­æµæµªåŠ¨ç‰©æ•‘åŠ© - ç™»å½•</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #ff6b6b;
            --secondary-color: #4ecdc4;
            --text-color: #333;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            height: 100vh;
            overflow: hidden;
            display: flex;
        }

        /* === å·¦ä¾§ï¼šæµ·æŠ¥è½®æ’­åŒº === */
        .poster-section {
            flex: 6;
            position: relative;
            background-color: #333;
            overflow: hidden;
        }
        .bg-slide {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover;
            background-position: center;
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
            transform: scale(1.05); /* è½»å¾®æ”¾å¤§æ•ˆæœ */
        }
        .bg-slide.active { opacity: 0.8; }
        
        .overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(0,0,0,0.2), rgba(0,0,0,0.7));
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 60px;
            color: white;
            z-index: 2;
        }
        .overlay h1 { font-size: 3.5em; margin-bottom: 15px; text-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .overlay p { font-size: 1.4em; opacity: 0.9; max-width: 600px; line-height: 1.6; }
        .dots { display: flex; gap: 10px; margin-top: 30px; }
        .dot { width: 12px; height: 12px; background: rgba(255,255,255,0.4); border-radius: 50%; cursor: pointer; transition: 0.3s; }
        .dot.active { background: white; transform: scale(1.2); }

        /* === å³ä¾§ï¼šç™»å½•è¡¨å•åŒº === */
        .login-section {
            flex: 4;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: -5px 0 20px rgba(0,0,0,0.05);
            z-index: 10;
        }
        .login-wrapper {
            width: 80%;
            max-width: 400px;
            padding: 40px;
        }
        .brand {
            font-size: 2em;
            color: var(--primary-color);
            margin-bottom: 10px;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .welcome-text { color: #888; margin-bottom: 40px; font-size: 1.1em; }

        .input-group { position: relative; margin-bottom: 25px; }
        .input-group i {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #aaa;
            transition: 0.3s;
        }
        .input-group input {
            width: 100%;
            padding: 16px 20px 16px 50px;
            border: 2px solid #f0f2f5;
            border-radius: 12px;
            font-size: 16px;
            outline: none;
            transition: 0.3s;
            background: #f9fbfc;
        }
        .input-group input:focus {
            border-color: var(--primary-color);
            background: white;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.1);
        }
        .input-group input:focus + i { color: var(--primary-color); }

        .btn-login {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #ff6b6b, #ff8e53);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
            box-shadow: 0 10px 20px rgba(255, 107, 107, 0.3);
        }
        .btn-login:hover { transform: translateY(-3px); box-shadow: 0 15px 30px rgba(255, 107, 107, 0.4); }
        .btn-login:active { transform: scale(0.98); }
        .btn-login:disabled { background: #ccc; cursor: not-allowed; box-shadow: none; }

        .footer-links {
            margin-top: 30px;
            text-align: center;
            font-size: 0.95em;
            color: #666;
        }
        .footer-links a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
            margin-left: 5px;
        }
        .footer-links a:hover { text-decoration: underline; }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            body { flex-direction: column; }
            .poster-section { flex: 1; display: none; } /* æ‰‹æœºç«¯éšè—æµ·æŠ¥æˆ–ç¼©å° */
            .login-section { flex: 1; }
        }
    </style>
</head>
<body>

<div class="poster-section" id="slider-container">
    <div class="overlay">
        <h1>æ¯ä¸€æ¬¡ç›¸é‡<br>éƒ½æ˜¯å¥‡è¿¹ âœ¨</h1>
        <p>æ ¡å›­æµæµªåŠ¨ç‰©æ•‘åŠ©å¹³å°è‡´åŠ›äºä¸ºæ¯ä¸€ä¸ªå°ç”Ÿå‘½å¯»æ‰¾æ¸©æš–çš„å½’å®¿ã€‚<br>åŠ å…¥æˆ‘ä»¬ï¼Œç”¨çˆ±ç»ˆæ­¢æµæµªã€‚</p>
        <div class="dots" id="dots-container"></div>
    </div>
    </div>

<div class="login-section">
    <div class="login-wrapper">
        <div class="brand"><i class="fas fa-paw"></i> æ•‘åŠ©ç«™</div>
        <p class="welcome-text">æ¬¢è¿å›æ¥ï¼Œè¯·ç™»å½•æ‚¨çš„è´¦å· ğŸ‘‹</p>
        
        <div class="input-group">
            <input type="text" id="username" placeholder="ç”¨æˆ·å / å­¦å·" autocomplete="off">
            <i class="fas fa-user"></i>
        </div>
        <div class="input-group">
            <input type="password" id="password" placeholder="å¯†ç ">
            <i class="fas fa-lock"></i>
        </div>
        
        <button class="btn-login" onclick="handleLogin()">ç«‹å³ç™»å½•</button>
        
        <div class="footer-links">
            è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ<a href="register.html">æ³¨å†Œæ–°è´¦å·</a>
        </div>
    </div>
</div>

<script>
    const SERVER_URL = "http://127.0.0.1:8000"; // ç¡®ä¿æ­¤åœ°å€ä¸åç«¯ä¸€è‡´
    
    // é…ç½®è½®æ’­å›¾ç‰‡ (ä½¿ç”¨æ‚¨å·²ä¸Šä¼ çš„å›¾ç‰‡)
    const images = [
        "/animals/å¤§æ©˜.jpg", 
        "/animals/å°ç™½.jpg", 
        "/animals/å¥¥åˆ©å¥¥.jpg",
        "/animals/å¤§å¤´.jpg",
        "/animals/æ—ºè´¢.jpg",
        "/animals/ç…¤çƒ.jpg"
    ];

    // åˆå§‹åŒ–è½®æ’­å›¾
    function initSlider() {
        const container = document.getElementById('slider-container');
        const dotsContainer = document.getElementById('dots-container');
        
        images.forEach((img, index) => {
            // åˆ›å»ºèƒŒæ™¯å±‚
            const div = document.createElement('div');
            div.className = `bg-slide ${index === 0 ? 'active' : ''}`;
            // æ‹¼æ¥å®Œæ•´ URL
            div.style.backgroundImage = `url('${SERVER_URL}${img}')`;
            container.insertBefore(div, container.firstChild); // æ’å…¥åˆ°é®ç½©å±‚ä¸‹é¢

            // åˆ›å»ºæŒ‡ç¤ºç‚¹
            const dot = document.createElement('div');
            dot.className = `dot ${index === 0 ? 'active' : ''}`;
            dot.onclick = () => switchSlide(index);
            dotsContainer.appendChild(dot);
        });

        // è‡ªåŠ¨æ’­æ”¾
        let current = 0;
        setInterval(() => {
            current = (current + 1) % images.length;
            switchSlide(current);
        }, 5000);
    }

    function switchSlide(index) {
        const slides = document.querySelectorAll('.bg-slide');
        const dots = document.querySelectorAll('.dot');
        
        slides.forEach(s => s.classList.remove('active'));
        dots.forEach(d => d.classList.remove('active'));
        
        slides[images.length - 1 - index].classList.add('active'); // æ³¨æ„æ’å…¥é¡ºåºæ˜¯åçš„
        dots[index].classList.add('active');
    }

    // ç™»å½•é€»è¾‘ (ä¿æŒåŸæœ‰åŠŸèƒ½ä¸å˜)
    async function handleLogin() {
        const u = document.getElementById('username').value;
        const p = document.getElementById('password').value;
        const btn = document.querySelector('.btn-login');

        if(!u || !p) {
            alert("è¯·è¾“å…¥å®Œæ•´çš„è´¦å·å’Œå¯†ç ");
            return;
        }

        btn.innerText = "ç™»å½•ä¸­...";
        btn.disabled = true;

        try {
            const res = await fetch(`${SERVER_URL}/login`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({username: u, password: p})
            });

            if(res.ok) {
                const data = await res.json();
                localStorage.setItem('currentUser', JSON.stringify(data));
                btn.style.background = "#28a745"; // æˆåŠŸå˜ç»¿
                btn.innerText = "âœ¨ ç™»å½•æˆåŠŸï¼";
                
                setTimeout(() => { 
                    if (data.role === 'admin') {
                        location.href = 'admin.html';
                    } else {
                        location.href = 'home.html';
                    }
                }, 800);
            } else {
                const err = await res.json();
                alert("ç™»å½•å¤±è´¥ï¼š" + err.detail);
                resetBtn();
            }
        } catch(e) {
            console.error(e);
            alert("æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œè¯·ç¡®ä¿åç«¯å·²å¯åŠ¨");
            resetBtn();
        }

        function resetBtn(){ 
            btn.innerText = "ç«‹å³ç™»å½•"; 
            btn.disabled = false; 
            btn.style.background = ""; // æ¢å¤åŸè‰²
        }
    }

    // å›è½¦é”®ç™»å½•æ”¯æŒ
    document.addEventListener('keydown', function(event) { 
        if(event.key === "Enter") handleLogin(); 
    });

    // å¯åŠ¨
    window.onload = initSlider;
</script>
</body>
</html>